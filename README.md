# Explore With Me (EWM) — Microservices Edition

## О проекте
Данный проект представляет собой переход от монолитной архитектуры к микросервисной. Основная цель — разделение ответственности между компонентами системы, обеспечение независимой масштабируемости и изоляция данных. Система предназначена для организации мероприятий, управления участием в них и взаимодействия между пользователями через систему комментариев.

---

## Архитектура системы

Система построена на стеке Spring Cloud и включает в себя следующие компоненты:

### Бизнес-сервисы
* **user-service** - управление учетными записями пользователей.
* **event-service** - управление жизненным циклом событий (создание, модерация, поиск).
* **request-service** - обработка заявок на участие и контроль лимитов участников.
* **comment-service** - функционал отзывов и обсуждений под событиями.

### Рекомендательная система 
Вместо классического сервиса статистики внедрена трехуровневая система обработки данных:

* **Collector** - gRPC-сервер, принимающий сырые данные о действиях пользователей и транслирующий их в Kafka (topic: stats.user-actions.v1).
* **Aggregator** - стриминговый сервис. Читает логи действий, вычисляет коэффициенты сходства мероприятий и передает результаты дальше (topic: stats.events-similarity.v1).
* **Analyzer** - аналитическое ядро. Аккумулирует данные из Kafka в БД, вычисляет веса предпочтений и предоставляет gRPC API для получения персональных рекомендаций.

### Инфраструктурные компоненты
* **Gateway Server** - единая точка входа. Осуществляет маршрутизацию внешних HTTP-запросов к соответствующим сервисам.
* **Discovery Server (Netflix Eureka)** - обеспечивает механизм регистрации и обнаружения сервисов (Service Discovery).
* **Config Server** - централизованное хранилище конфигураций. Позволяет управлять настройками всех сервисов из единой точки (репозитория конфигураций).

Взаимодействие между сервисами реализовано через декларативный HTTP-клиент **OpenFeign**. Каждый сервис имеет выделенную базу данных в PostgreSQL, что исключает прямую зависимость на уровне хранения данных.

---

## Внутреннее API (Feign Clients)

Для обеспечения целостности данных микросервисы взаимодействуют по внутренним протоколам. Примеры ключевых операций:

* **Проверка зависимостей:** При создании комментария `comment-service` обращается к `user-service` и `event-service` для подтверждения существования авторов и событий.
* **Синхронизация участников:** `event-service` запрашивает у `request-service` актуальное количество подтвержденных заявок для корректного отображения лимитов.


---
## Технологический стек

- Java 21
- Spring Boot
- Spring Cloud (Eureka, Config Server, Gateway)
- OpenFeign
- Resilience4j
- PostgreSQL
- Docker, Docker Compose 
- Maven 
- Apache Kafka
- Protobuf
- gRPC

---
## Нефункциональные аспекты

- Отказоустойчивость: Circuit Breaker (Resilience4j)
- Централизованная конфигурация
- Изоляция данных
- Горизонтальное масштабирование сервисов

---
## Конфигурация и запуск


### Порядок запуска:
1. Infrastructure: Discovery Server, Config Server, Kafka.
2. Data Layer: Collector, Aggregator, Analyzer.
3. Business Logic: User, Event, Request, Comment services.
4. Entry Point: Gateway Server.

>Все параметры подключения, уровни логирования и настройки Resilience4j (Circuit Breaker) подгружаются динамически через Config Server.

---

## Внешние спецификации API

Проект полностью реализует требования API Yandex Practicum. Ознакомиться со спецификациями можно по ссылкам:
* [Postman коллекция](https://raw.githubusercontent.com/yandex-praktikum/java-plus-graduation/refs/heads/ci/.github/workflows/stuff/postman/recommendations/ewm-main-service.json)
